@page
@model PRN211GroupProject.Pages.Accounts.BookingModel
@{
    ViewData["Title"] = "Booking";
}

<div id="preloader-active">
    <div class="preloader d-flex align-items-center justify-content-center">
        <div class="preloader-inner position-relative">
            <div class="preloader-circle"></div>
            <div class="preloader-img pere-text">
                <img src="~/assets/img/logo/logo.png" alt="">
            </div>
        </div>
    </div>
</div>
<main>
    <!-- Hero Area Start -->
    <div class="slider-area2 slider-height2 d-flex align-items-center">
        <div class="container">
            <div class="row">
                <div class="col-xl-12">
                    <div class="hero-cap text-center pt-50">
                        <h2>Booking</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <body>
        @{
            // Get the current date
            DateTime currentDate = DateTime.Today.AddDays(Model._offset * 7);

            // Calculate the start of the current week (Sunday)
            DateTime startOfWeek = currentDate.AddDays(-(int)currentDate.DayOfWeek);

            // Calculate the end of the current week (Saturday)
            DateTime endOfWeek = startOfWeek.AddDays(6);

        }
        <header class="cd-main-header text-center flex flex-column flex-center">
            <p class="margin-top-md margin-bottom-xl"></p>

            <h1 class="text-xl"><a href="/Accounts/Booking?offset=@(Model._offset - 1)"><i class="fa fa-angle-left"></i></a> @startOfWeek.ToShortDateString() - @endOfWeek.ToShortDateString() <a href="/Accounts/Booking?offset=@(Model._offset + 1)"><i class="fa fa-angle-right"></i></a></h1>
        </header>
        <div class="cd-schedule cd-schedule--loading margin-top-lg margin-bottom-lg js-cd-schedule">
            <div class="cd-schedule__timeline">
                <ul>
                    <li><span>09:00</span></li>
                    <li><span>09:30</span></li>
                    <li><span>10:00</span></li>
                    <li><span>10:30</span></li>
                    <li><span>11:00</span></li>
                    <li><span>11:30</span></li>
                    <li><span>12:00</span></li>
                    <li><span>12:30</span></li>
                    <li><span>13:00</span></li>
                    <li><span>13:30</span></li>
                    <li><span>14:00</span></li>
                    <li><span>14:30</span></li>
                    <li><span>15:00</span></li>
                    <li><span>15:30</span></li>
                    <li><span>16:00</span></li>
                    <li><span>16:30</span></li>
                    <li><span>17:00</span></li>
                    <li><span>17:30</span></li>
                    <li><span>18:00</span></li>
                </ul>
            </div>

            <div class="cd-schedule__events">
                <ul>
                    @foreach (DayOfWeek day in Enum.GetValues(typeof(DayOfWeek)))
                    {
                        <li class="cd-schedule__group">
                            <div class="cd-schedule__top-info"><span>@day.ToString()</span></div>
                            <ul>

                            @if (Model.Bookings != null)
                            {
                                var dayBookings = Model.Bookings.Where(b => b.Started.DayOfWeek == day);

                                @if (dayBookings.Any())
                                {
                                        @foreach (var item in dayBookings)
                                        {
                                            <li class="cd-schedule__event">
                                                <a data-start="@item.Started.ToString("HH:mm")" data-end="@item.Ended.ToString("HH:mm")" data-content="event-abs-circuit" data-event="event-1" href="#0">
                                                    <em class="cd-schedule__name">@item.Available.Service.Name <br/> @item.Available.Spot.Name</em>
                                                    
                                                </a>
                                            </li>
                                        }
                                }

                                }

                                <li style="visibility: hidden; opacity: 0;" class="cd-schedule__event"><a style=" visibility: hidden; opacity: 0;" data-start="08:00" data-end="08:00" data-content="event-abs-circuit" data-event="event-1" href="#0"><em></em></a></li>

                                </ul>
                        </li>
                    }
                </ul>
            </div>

            <div class="cd-schedule-modal">
                <header class="cd-schedule-modal__header">
                    <div class="cd-schedule-modal__content">
                        <span class="cd-schedule-modal__date"></span>
                        <h3 class="cd-schedule-modal__name"></h3>
                    </div>

                    <div class="cd-schedule-modal__header-bg"></div>
                </header>

                <div class="cd-schedule-modal__body">
                    <div class="cd-schedule-modal__event-info"></div>
                    <div class="cd-schedule-modal__body-bg"></div>
                </div>

                <a href="#0" class="cd-schedule-modal__close text-replace">Close</a>
            </div>

            <div class="cd-schedule__cover-layer"></div>
        </div> <!-- .cd-schedule -->
        <script src="~/scheduleAssets/assets/js/util.js"></script> <!-- util functions included in the CodyHouse framework -->
        <script src="~/scheduleAssets/assets/js/main.js"></script>
    </body>
</main>
